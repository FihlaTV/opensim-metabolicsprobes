<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>OpenSim Documentation : Probes</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
        <div id="page">
            <div id="main">
                <div id="main-header" class="pageSectionHeader">
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            OpenSim Documentation : Probes
                        </span>
                    </h1>

                    <div class="page-metadata">
                        <p>This page last changed on Aug 09, 2013 by <font color="#0050B2">kevinxu</font>.</p>
                    </div>
                </div>

                <div id="content" class="view">
                    <div id="main-content" class="wiki-content group">
                    <p><div>
<ul>
    <li><a href='#Probes-IntroductiontoOpenSimProbes'>Introduction to OpenSim Probes</a></li>
    <li><a href='#Probes-SpecifyingProbesintheOpenSimModel'>Specifying Probes in the OpenSim Model</a></li>
<ul>
    <li><a href='#Probes-AddingandDeletingProbesintheGUI'>Adding and Deleting Probes in the GUI</a></li>
    <li><a href='#Probes-ProbeParameters'>Probe Parameters</a></li>
</ul>
    <li><a href='#Probes-ProbeReporterAnalysisforreportingprobeoutputstofile'>ProbeReporter Analysis (for reporting probe outputs to file)</a></li>
    <li><a href='#Probes-CreatingyourownprobeforadvancedOpenSimAPIusers'>Creating your own probe (for advanced OpenSim API users)</a></li>
</ul></div></p><h2 id="Probes-IntroductiontoOpenSimProbes">Introduction to OpenSim Probes</h2><p>Probes are model components that perform vector measurements on an OpenSim model during a simulation. These measurements can then be output to an external file using a ProbeReporter analysis. This is a valuable new feature of OpenSim as it exposes the time history of an unlimited variety of model parameters to the user during a simulation. Currently available Probes include:</p><ul><li>ActuatorForceProbe: measures the force of an OpenSim Actuator.</li><li>ActuatorPowerProbe: measures the power of an OpenSim Actuator.</li><li>JointInternalPowerProbe: measures the internal power of an OpenSim Joint.</li><li>SystemEnergyProbe: measures the total energy state of a model.</li><li>Umberger2010MuscleMetabolicsProbe: measures muscle metabolic power (based on Umberger et al., (2003 and 2010)) -- Available in OpenSim 3.1 and later</li><li>Bhargava2004MuscleMetabolicsProbe: measures muscle metabolic power (based on <a href="http://www.ncbi.nlm.nih.gov/pubmed/14672571" class="external-link" rel="nofollow">Bhargava et al., (2004)</a>) -- Available in OpenSim 3.1 and later</li></ul><p>In addition to querying a model value, Probes can apply an <em>operation </em>to that value. Available operations in OpenSim 3.0 are:</p><ul><li>“<em>value</em>”: No operation performed: this just returns the probe input value.</li><li>“<em>integrate</em>”: Returns the integral of the probe value. Note that you must specify initial conditions.</li><li>“<em>differentiate</em>”: Returns the derivative of the probe value.</li></ul><p>Finally, a scaling factor may also be applied to the output, after the operation has been applied. If a ProbeReporter analysis is attached to the model during a simulation, this will cycle through all Probes in the model and report them to a single file.</p><p>The data flow for a probe can be visually represented as follows:</p><p>------------------------------------------------------------------------         ------------------------------------------          ------------------------------------------------------------------<br />|   Probe Input (including the desired '<em>operation</em>')   |  ----&gt; |  Apply user selected '<em>gain</em>'  |  ----&gt;  |  Probe Output (via ProbeReporter Analysis)  |<br />------------------------------------------------------------------------         ------------------------------------------          ------------------------------------------------------------------</p><p>The combination of different operations and different Probe components provides a rich set of data that can be extracted during a model simulation. For example:</p><ol><li>The ActuatorPower Probe can be used with the “<em>integrate</em>” operation to return the work generated by each Actuator during a simulation.</li><li>The total system power can be measured by using a SystemEnergyProbe with the “<em>differentiate</em>” operation.</li><li>The sum of several forces in the model can be scaled by 3X by using the ForceProbe with the “<em>value</em>” operation and a &quot;<em>gain</em>&quot; of 3.0.</li><li>The net metabolic energy consumed by a list of muscles in the model.</li></ol><h2 id="Probes-SpecifyingProbesintheOpenSimModel">Specifying Probes in the OpenSim Model</h2><h3 id="Probes-AddingandDeletingProbesintheGUI">Adding and Deleting Probes in the GUI</h3><div class="table-wrap"><table class="confluenceTable"><tbody><tr><th class="nohighlight confluenceTh"><p><img class="confluence-embedded-image" src="attachments/3376219/5046710.png" data-image-src="attachments/3376219/5046710.png"></p><p><img class="confluence-embedded-image" src="attachments/3376219/5046711.png" data-image-src="attachments/3376219/5046711.png"></p></th><th class="nohighlight confluenceTh"><p>Starting with OpenSim 3.1 you can add and delete probes in the OpenSim GUI.</p><p>To add a probe:</p><ol><li>Go to the Model of interest in the <strong>Navigator</strong> and find the <strong>Probes</strong> node.</li><li>Right click and select <strong>New Probe...</strong></li><li>Give the probe a name and choose the type of probe (e.g. ActuatorForceProbe).</li></ol><p>Specify the probe's parameters:</p><ol><li>Find the probe you've added and bring up its properties in the <strong>Property Editor</strong></li><li>You can use the Property Editor to specify the relevant parameters.</li><li>Note that for some properties (e.g. MetabolicParameterSet), you will need to make changes in the XML file directly</li></ol><p>See the section below for more information about the parameters of a probe.</p><p>To delete a probe, Right click on the probe of interest in the Navigator panel and select Delete.</p><p> </p></th></tr></tbody></table></div><div class='panelMacro'><table class='infoMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/information.png" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><p><strong>Using probes with the gait workflow?</strong> Please note that the Residual Reduction Tool makes a copy of your model and then removes all the actuators. If you've added probes to the model that rely on any of these actuators, OpenSim will disable them. If you run RRA and choose to Adjust the model, you'll need to re-enable your probes.</p></td></tr></table></div><h3 id="Probes-ProbeParameters">Probe Parameters</h3><p>Probes are specified within a &lt;ProbeSet&gt; in the *.osim model file. Although individual probes may have their own properties, all probes should contain the following properties:</p><ul><li><em>isDisabled</em>: specify whether or not the probe is disabled or enabled.</li><li><em>operation_to_apply_to_probe</em>: a string that contains the operation to be performed on the probe value (available operations: 'value', 'integrate', 'differentiate').</li><li><em>initial_conditions_for_integration</em>: initial conditions for the integration. Only required if the “<em>integrate</em>” operation is selected.</li><li><em>gain</em>: gain to apply to the result, post-operation.</li><li><em>sum_forces_together</em>: specify whether to report the sum of all actuator forces or report the sum and each force value separately</li></ul><p>To get a list of required properties for a specific probe, use the XML browser or Property Editor in the GUI, type “analyze –PI &lt;ProbeName&gt;” from the command prompt or see the <a href="https://simtk.org/api_docs/opensim/api_docs/classOpenSim_1_1Probe.html" class="external-link" rel="nofollow">Doxygen for Probes</a>.</p><p>Example XML code (valid for OpenSim 3.1) for some example probes:</p><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>Probe ModelComponent Examples</b></div><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: html/xml; collapse: true; gutter: false">&lt;!--Probes in the model.--&gt;
&lt;ProbeSet&gt;
  &lt;objects&gt;
 
    &lt;!-- PROBE TO CALCULATE THE WORK DONE BY AN ACTUATOR --&gt;
    &lt;ActuatorPowerProbe name="ActuatorPower"&gt;
      &lt;!-- Flag indicating whether the Probe is disabled or not. Disabled means that the Probe will not be reported using the ProbeReporter.--&gt;
      &lt;isDisabled&gt;false&lt;/isDisabled&gt;
      &lt;!--The operation to perform on the probe value: 'value'(no operation, just return the probe value), 'integrate', 'differentiate'--&gt;
      &lt;probe_operation&gt;integrate&lt;/probe_operation&gt;
      &lt;!--Initial condition--&gt;
      &lt;initial_conditions_for_integration&gt;0&lt;/initial_conditions_for_integration&gt;
      &lt;!--Specify a list of model Actuators whose work should be calculated. If multiple Actuators are given, the probe value will be the summation of all actuator powers.--&gt;
      &lt;actuator_names&gt;myMuscle&lt;/actuator_names&gt;
      &lt;!--Gain.--&gt;
      &lt;gain&gt;1.0&lt;/gain&gt;
	  &lt;!--Flag to specify whether to report the sum of all actuator powers, or report each actuator power value separately.--&gt;
       &lt;sum_powers_together&gt;false&lt;/sum_powers_together&gt;
    &lt;/ActuatorPowerProbe&gt;
 
 
    &lt;!-- PROBE TO CALCULATE THE KINETIC AND POTENTIAL POWER OF THE MODEL --&gt;
    &lt;SystemEnergyProbe name="SystemPower"&gt;
      &lt;!-- Flag indicating whether the Probe is disabled or not. Disabled means that the Probe will not be reported using the ProbeReporter.--&gt;
      &lt;isDisabled&gt;false&lt;/isDisabled&gt;
      &lt;!--The operation to perform on the probe value: 'value'(no operation, just return the probe value), 'integrate', 'differentiate'--&gt;
      &lt;probe_operation&gt;differentiate&lt;/probe_operation&gt;
      &lt;!--Specify whether kinetic energy is to be included in the system energy computation (true/false).--&gt;
      &lt;compute_kinetic_energy&gt;true&lt;/compute_kinetic_energy&gt;
      &lt;!--Specify whether potential energy is to be included in the system energy computation (true/false).--&gt;
      &lt;compute_potential_energy&gt;true&lt;/compute_potential_energy&gt;
      &lt;!--Gain.--&gt;
      &lt;gain&gt;1.0&lt;/gain&gt;
    &lt;/SystemEnergyProbe&gt;
 
 
    &lt;!-- PROBE TO CALCULATE THE SUM OF MUSCLE FORCES IN THE MODEL, SCALED BY THREE --&gt;
    &lt;ActuatorForceProbe name="ForceSummationScaledByThree"&gt;
      &lt;!-- Flag indicating whether the Probe is disabled or not. Disabled means that the Probe will not be reported using the ProbeReporter.--&gt;
      &lt;isDisabled&gt;false&lt;/isDisabled&gt;
      &lt;!--The operation to perform on the probe value: 'value'(no operation, just return the probe value), 'integrate', 'differentiate'--&gt;
      &lt;probe_operation&gt;value&lt;/probe_operation&gt;
      &lt;!--Sum all forces.--&gt;
      &lt;sum_forces_together&gt;true&lt;/sum_forces_together&gt;
      &lt;!--Gain.--&gt;
      &lt;gain&gt;3.0&lt;/gain&gt;
      &lt;!--Specify a list of model Forces whose impulse should be calculated. If multiple Forces are given, the probe value will be the summation of all forces, and the integral will be the summation of all impulses.--&gt;
      &lt;actuator_names&gt;myMuscle1 myMuscle2 myMuscle3&lt;/actuator_names&gt;
    &lt;/ActuatorForceProbe&gt;</pre>
		</div>
</div></div><h2 id="Probes-ProbeReporterAnalysisforreportingprobeoutputstofile">ProbeReporter Analysis (for reporting probe outputs to file)</h2><p>When Probes are specified in an OpenSim model, they will be automatically evaluated during a simulation. However the probe output values will not be reported to file unless a ProbeReporter analysis is also attached to the simulation (more information on OpenSim <a href="Analyses.html">Analyses</a>). The ProbeReporter 's job is to cycle through all 'enabled' Probes in the model at a user specified simulation step interval, and report their values to an external file. Note that an Analysis is <em>not</em> a ModelComponent, and therefore <em>not</em> specified as part of the model. Rather, OpenSim analyses are set up as part of the tool that is invoked to perform a simulation. E.g. inside the RRA/CMC/Forward setup file under &lt;AnalysisSet&gt;.</p><div class='panelMacro'><table class='infoMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/information.png" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><p>For probes set to &quot;integrate&quot; you must attached the ProbeReporter Analysis to the Forward Tool or CMC Tool. The Analyze tool does not perform an integration.</p></td></tr></table></div><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>ProbeReporter</b></div><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: html/xml; collapse: true; gutter: false">&lt;AnalysisSet name="MyAnalyses"&gt;
	&lt;objects&gt;
		&lt;ProbeReporter name="MyProbeReporter"&gt;
			&lt;!--Flag (true or false) specifying whether whether on. True by default.--&gt;
			&lt;on&gt; true &lt;/on&gt;
			&lt;!--Specifies how often to store results during a simulation. More
				specifically, the interval (a positive integer) specifies how many
				successful integration steps should be taken before results are
				recorded again.--&gt;
			&lt;step_interval&gt; 10 &lt;/step_interval&gt;
		&lt;/ProbeReporter&gt;
	&lt;/objects&gt;
	&lt;groups/&gt;
&lt;/AnalysisSet&gt;</pre>
		</div>
</div></div><h2 id="Probes-CreatingyourownprobeforadvancedOpenSimAPIusers">Creating your own probe (for advanced OpenSim API users)</h2><p>Custom child class Probes may be created by overriding the following pure virtual methods:</p><ul><li>SimTK::Vector computeProbeInputs(SimTK::State&amp; s) : defines the vector value of the probe as a function of the current system state s.</li><li>int getNumProbeInputs() : defines the number of probe inputs in the return vector from computeProbeInputs().</li><li>Array&lt;std:string&gt; getProbeOutputLabels() : defines the labels for the probe outputs (used in the ProbeReporter Analysis for reporting to file).</li></ul><p>See the <a href="https://simtk.org/api_docs/opensim/api_docs/classOpenSim_1_1Probe.html" class="external-link" rel="nofollow">Probe Doxygen</a> for more details on using the API to create custom Probes. </p><p>ap over it remain mostly parallel to the same axis throughout their range of motion, then the axial method will produce well-behaved wrapping paths.</p><div class="panel" style="background-color: white;border-color: gray;border-style: solid;border-width: 5px;"><div class="panelContent" style="background-color: white;">
<p>Next: <a href="OpenSim%2BModels.html">OpenSim Models</a></p><p>Previous: <a href="Joint%2BReactions%2BAnalysis.html">Joint Reactions Analysis</a></p>
</div></div><p> </p>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/3376219/5046710.png">probe1.PNG</a> (image/png)
                                <br/>
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/3376219/5046711.png">probe2.PNG</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" style="background: url(http://simtk-confluence.stanford.edu:8080/images/border/border_bottom.gif) repeat-x;">
                <p><small>Document generated by Confluence on Feb 24, 2014 09:28</small></p>
            </div>
        </div>     </body>
</html>
