<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>OpenSim Documentation : CMC Settings Files and XML Tag Definitions</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
        <div id="page">
            <div id="main">
                <div id="main-header" class="pageSectionHeader">
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            OpenSim Documentation : CMC Settings Files and XML Tag Definitions
                        </span>
                    </h1>

                    <div class="page-metadata">
                        <p>This page last changed on Jun 10, 2013 by <font color="#0050B2">jenhicks</font>.</p>
                    </div>
                </div>

                <div id="content" class="view">
                    <div id="main-content" class="wiki-content group">
                    <p>This section of the chapter covers how to control CMC execution. The properties governing execution are contained in XML files. Â The topics covered in this section include:</p><p><div>
<ul>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-CMCSetupFile'>CMC Setup File</a></li>
<ul>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-Example1XMLfilefortheCMCsetupfile'>Example 1: XML file for the CMC setup file</a></li>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-SpecifyingtheModel'>Specifying the Model</a></li>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-SpecifyingInitialandFinalTimes'>Specifying Initial and Final Times</a></li>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-SpecifyingIntegratorSettings'>Specifying Integrator Settings</a></li>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-SpecifyingAnalysesandResults'>Specifying Analyses and Results</a></li>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-SpecifyingDesiredKinematics'>Specifying Desired Kinematics</a></li>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-SpecifyingExternalLoads'>Specifying External Loads</a></li>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-ControllingtheOptimizer'>Controlling the Optimizer</a></li>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-SettingsfortheCMCalgorithm'>Settings for the CMC algorithm</a></li>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-SpecifyingTrackingTasksandControlConstraints'>Specifying Tracking Tasks and Control Constraints</a></li>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-SpecifyingActuatorstoExclude'>Specifying Actuators to Exclude</a></li>
</ul>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-TaskSetFile'>Task Set File</a></li>
<ul>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-TaskSets'>Task Sets</a></li>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-TaskTypes'>Task Types</a></li>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-Example2XMLfilefortheCMCtasksetfile'>Example 2: XML file for the CMC task set file</a></li>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-TaskProperties'>Task Properties</a></li>
</ul>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-ControlConstraintsFile'>Control Constraints File</a></li>
<ul>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-ControlSets'>Control Sets</a></li>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-DefaultObjects'>Default Objects</a></li>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-PropertiesofControlLinearControlType'>Properties of &lt;ControlLinear&gt; Control Type</a></li>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-Example3XMLfilefortheCMCcontrolconstraintsfile'>Example 3: XML file for the CMC control constraints file</a></li>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-Example4UsingcontrolconstraintsfiletoconstrainCMCexcitationstomatchEMGdata'>Example 4: Using control constraints file to constrain CMC excitations to match EMG data</a></li>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-ResidualActuators'>Residual Actuators</a></li>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-ReserveActuators'>Reserve Actuators</a></li>
    <li><a href='#CMCSettingsFilesandXMLTagDefinitions-Muscles'>Muscles</a></li>
</ul>
</ul></div></p><h2 id="CMCSettingsFilesandXMLTagDefinitions-CMCSetupFile">CMC Setup File</h2><p>Execution of the CMC tool is controlled by properties specified in the CMC setup file. Some properties, such as <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">initial_time</span><span style="color: rgb(0,0,255);">&gt;</span> and <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">final_time</span><span style="color: rgb(0,0,255);">&gt;</span>, are specified directly in the CMC setup file. Other properties, such as <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">task_set_file</span><span style="color: rgb(0,0,255);">&gt;</span>, refer to additional files that contain additional settings that affect CMC execution. These are discussed in the sections that follow.</p><p>The properties for CMC are enclosed inside the opening and closing tags <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">CMCTool</span><span style="color: rgb(0,0,255);">&gt;</span> and <span style="color: rgb(0,0,255);">&lt;/</span><span style="color: rgb(128,0,0);">CMCTool</span><span style="color: rgb(0,0,255);">&gt;</span>. The name attribute <span style="color: rgb(255,0,0);">name</span><span style="color: rgb(0,0,255);">=&quot;subject01_walk1&quot;</span> specifies the execution name. The names of results files generated will be prefixed with this name.</p><h3 id="CMCSettingsFilesandXMLTagDefinitions-Example1XMLfilefortheCMCsetupfile">Example 1: XML file for the CMC setup file</h3><div class="code panel" style="border-width: 1px;"><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: html/xml; gutter: false">&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;OpenSimDocument Version="20302"&gt;
 
  &lt;CMCTool name="subject01_walk1"&gt;
    &lt;!--Name of the .osim file used to construct a model.--&gt;
    &lt;model_file&gt; subject01_simbody_adjusted.osim &lt;/model_file&gt;

    &lt;!--Replace the model's force set with sets specified in
        &lt;force_set_files&gt;? If false, the force set is appended to.--&gt;
    &lt;replace_force_set&gt; false &lt;/replace_force_set&gt;

    &lt;!--List of xml files used to construct an force set for the model.--&gt;
    &lt;force_set_files&gt; gait2354_CMC_Actuators.xml &lt;/force_set_files&gt;

    &lt;!--Directory used for writing results.--&gt;
    &lt;results_directory&gt; ./subject01_ResultsCMC &lt;/results_directory&gt;

    &lt;!--Output precision. It is 8 by default.--&gt;
    &lt;output_precision&gt; 20 &lt;/output_precision&gt;

    &lt;!--Initial time for the simulation.--&gt;
    &lt;initial_time&gt; 0.76000000 &lt;/initial_time&gt;

    &lt;!--Final time for the simulation.--&gt;
    &lt;final_time&gt; 1.24000000 &lt;/final_time&gt;

    &lt;!--Flag indicating whether or not to compute equilibrium values for
        states other than the coordinates or speeds. For example, equilibrium
        muscle fiber lengths or muscle forces.--&gt;
    &lt;solve_for_equilibrium_for_auxiliary_states&gt; true &lt;/solve_for_equilibrium_for_auxiliary_states&gt;

    &lt;!--Maximum number of integrator steps.--&gt;
    &lt;maximum_number_of_integrator_steps&gt; 30000 &lt;/maximum_number_of_integrator_steps&gt;

    &lt;!--Maximum integration step size.--&gt;
    &lt;maximum_integrator_step_size&gt; 1.00000000 &lt;/maximum_integrator_step_size&gt;

    &lt;!--Minimum integration step size.--&gt;
    &lt;minimum_integrator_step_size&gt; 0.00000000 &lt;/minimum_integrator_step_size&gt;

    &lt;!--Integrator error tolerance. When the error is greater, the integrator
        step size is decreased.--&gt;
    &lt;integrator_error_tolerance&gt; 0.00000100 &lt;/integrator_error_tolerance&gt;

    &lt;!--Set of analyses to be run during the investigation.--&gt;
    &lt;AnalysisSet name="Analyses"&gt;
      &lt;objects/&gt;
      &lt;groups/&gt;
    &lt;/AnalysisSet&gt;

    &lt;!--Controller objects in the model.--&gt;
    &lt;ControllerSet name="Controllers"&gt;
      &lt;objects/&gt;
      &lt;groups/&gt;
    &lt;/ControllerSet&gt;

    &lt;!--XML file (.xml) containing the forces applied to the model as
        ExternalLoads.--&gt;
    &lt;external_loads_file&gt; subject01_externalForces.xml &lt;/external_loads_file&gt;

    &lt;!--Motion (.mot) or storage (.sto) file containing the desired point
        trajectories.--&gt;
    &lt;desired_points_file&gt; &lt;/desired_points_file&gt;

    &lt;!--Motion (.mot) or storage (.sto) file containing the desired kinematic
        trajectories.--&gt;
    &lt;desired_kinematics_file&gt; subject01_walk1_RRA_Kinematics_initial_q.sto &lt;/desired_kinematics_file&gt;

    &lt;!--File containing the tracking tasks. Which coordinates are tracked and
        with what weights are specified here.--&gt;
    &lt;task_set_file&gt; gait2354_CMC_Tasks.xml &lt;/task_set_file&gt;

    &lt;!--File containing the constraints on the controls.--&gt;
    &lt;constraints_file&gt; gait2354_CMC_ControlConstraints.xml &lt;/constraints_file&gt;

    &lt;!--File containing the controls output by RRA. These can be used to place
        constraints on the residuals during CMC.--&gt;
    &lt;rra_controls_file&gt; &lt;/rra_controls_file&gt;

    &lt;!--Low-pass cut-off frequency for filtering the desired kinematics. A
        negative value results in no filtering. The default value is -1.0, so
        no filtering.--&gt;
    &lt;lowpass_cutoff_frequency&gt; -10.00000000 &lt;/lowpass_cutoff_frequency&gt;

    &lt;!--Time window over which the desired actuator forces are achieved.
        Muscles forces cannot change instantaneously, so a finite time window
        must be allowed. The recommended time window for RRA is about 0.001
        sec, and for CMC is about 0.010 sec.--&gt;
    &lt;cmc_time_window&gt; 0.01000000 &lt;/cmc_time_window&gt;

    &lt;!--Flag (true or false) indicating whether or not to use the curvature
        filter. Setting this flag to true can reduce oscillations in the
        computed muscle excitations.--&gt;
    &lt;use_curvature_filter&gt; false &lt;/use_curvature_filter&gt;

    &lt;!--Flag (true or false) indicating whether to use the fast CMC
        optimization target. The fast target requires the desired
        accelerations to be met. The optimizer fails if the acclerations
        constraints cannot be met, so the fast target can be less robust. The
        regular target does not require the acceleration constraints to be
        met; it meets them as well as it can, but it is slower and less
        accurate.--&gt;
    &lt;use_fast_optimization_target&gt; true &lt;/use_fast_optimization_target&gt;

    &lt;!--Preferred optimizer algorithm (currently support "ipopt" or "cfsqp",
        the latter requiring the osimFSQP library.--&gt;
    &lt;optimizer_algorithm&gt; ipopt &lt;/optimizer_algorithm&gt;

    &lt;!--Perturbation size used by the optimizer to compute numerical
        derivatives. A value between 1.0e-4 and 1.0e-8 is usually
        approprieate.--&gt;
    &lt;optimizer_derivative_dx&gt; 1.00000000 &lt;/optimizer_derivative_dx&gt;

    &lt;!--Convergence criterion for the optimizer. The smaller this value, the
        deeper the convergence. Decreasing this number can improve a solution,
        but will also likely increase computation time.--&gt;
    &lt;optimizer_convergence_criterion&gt; 0.00010000 &lt;/optimizer_convergence_criterion&gt;

    &lt;!--Maximum number of iterations for the optimizer.--&gt;
    &lt;optimizer_max_iterations&gt; 200 &lt;/optimizer_max_iterations&gt;

    &lt;!--Print level for the optimizer, 0 - 3. 0=no printing, 3=detailed
        printing, 2=in between--&gt;
    &lt;optimizer_print_level&gt; 0 &lt;/optimizer_print_level&gt;

    &lt;!--True-false flag indicating whether or not to turn on verbose printing
        for cmc.--&gt;
    &lt;use_verbose_printing&gt; false &lt;/use_verbose_printing&gt;

	&lt;!--List of individual Actuators by individual or user-defined group name to be excluded from CMC's control.--&gt;
 	&lt;actuators_to_exclude /&gt;

Â &lt;/CMCTool&gt;

&lt;/OpenSimDocument&gt;</pre>
		</div>
</div></div><h3 id="CMCSettingsFilesandXMLTagDefinitions-SpecifyingtheModel">Specifying the Model</h3><p>The &lt;model_file&gt; specifies the name of the .osim file used to construct and initialize the model. The &lt;force_set_files&gt; are a list of actuators set file names, each of which may be included as actuators of the model. These actuators are in addition to any actuators specified in the model file that are already part of the model. &lt;replace_force_set&gt;, if set to true, indicates that the actuator sets listed in &lt;force_set_files&gt; should replace any actuators that are already part of the model otherwise actuators are appended.</p><h3 id="CMCSettingsFilesandXMLTagDefinitions-SpecifyingInitialandFinalTimes">Specifying Initial and Final Times</h3><p>The properties <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">initial_time</span><span style="color: rgb(0,0,255);">&gt;</span> and <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">final_time</span><span style="color: rgb(0,0,255);">&gt;</span> specify the time interval over which CMC is to be run. Be aware that CMC uses 0.030 seconds starting from the specified initial time to initialize any muscle states. In addition, to avoid undesirable effects having to do with the processing of the desired kinematics and external loads, it is prudent not to start CMC at the very beginning of the desired kinematics but to allow a buffer. One or two percent of a gait cycle, for example, is usually sufficient.</p><h3 id="CMCSettingsFilesandXMLTagDefinitions-SpecifyingIntegratorSettings">Specifying Integrator Settings</h3><p>The <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">maximum_number_of_integrator_steps</span><span style="color: rgb(0,0,255);">&gt;</span> property indicates the maximum number of steps CMC can take during a run of the tool before terminating. Making the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">integrator_accuracy</span><span style="color: rgb(0,0,255);">&gt;</span> finer (smaller) will decrease the integrator step size.</p><h3 id="CMCSettingsFilesandXMLTagDefinitions-SpecifyingAnalysesandResults">Specifying Analyses and Results</h3><p>Any number of available analyses can be added to a CMC run. To get a listing of available analyses, open the CMC tool in the GUI and go the the Analyses pane and click on Add or see theÂ <a href="Analyses.html">Analyses</a> chapter.</p><p>There are several properties associated with the analyses results. <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">results_directory</span><span style="color: rgb(0,0,255);">&gt;</span> specifies the directory where results should be written. <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">output_precision</span><span style="color: rgb(0,0,255);">&gt;</span> specifies how many decimal places should be used when writing results. A value of 20 is sufficient to avoid round-off error when reading results back in during other steps in the workflow. <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">step_interval</span><span style="color: rgb(0,0,255);">&gt;</span> specifies how often to record results during numerical integration. A value of 10 means record results every 10 integration steps.</p><h3 id="CMCSettingsFilesandXMLTagDefinitions-SpecifyingDesiredKinematics">Specifying Desired Kinematics</h3><p>The file containing the desired kinematics is specified using the property <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">desired_kinematics_file</span><span style="color: rgb(0,0,255);">&gt;</span>. A low-pass cutoff frequency for filtering the kinematics can be specified using the property <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">lowpass_cutoff_frequency</span><span style="color: rgb(0,0,255);">&gt;</span>. An order 50 Finite Impulse Response Filter (FIR) is currently used. If the desired kinematics have already been filtered, as is normally the case by the time the CMC tool is used, specify a negative cutoff frequency to prevent any filtering at all.</p><h3 id="CMCSettingsFilesandXMLTagDefinitions-SpecifyingExternalLoads">Specifying External Loads</h3><p>There can be multiple sets of ground reaction forces for different locations on the body. These are specified in the file identified by the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">external_loads_file</span><span style="color: rgb(0,0,255);">&gt;</span> tags. The external loads .xml file specifies the source file for input forces and to which location and body the forces are to be applied. See <a href="Inverse%2BDynamics.html">Inverse Dynamics</a>Â for additional details for applying any number of external loads as point forces and/or body torques.Â </p><div class='panelMacro'><table class='infoMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/information.png" width="16" height="16" align="absmiddle" alt="" border="0"></td><td>Note: Across all steps in the OpenSim workflow, it is important to use the same settings for specifying the external loads.</td></tr></table></div><h3 id="CMCSettingsFilesandXMLTagDefinitions-ControllingtheOptimizer">Controlling the Optimizer</h3><p>A number of properties are available for controlling the optimizer. <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">use_fast_ optimization_target</span><span style="color: rgb(0,0,255);">&gt;</span> specifies whether the fast or slow optimization target should be used (<a href="How%2BRRA%2BWorks.html">How RRA Works</a>). <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">optimizer_derivative_dx</span><span style="color: rgb(0,0,255);">&gt;</span> specifies the perturbation size in the controls for computing numerical derivatives. <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">optimizer_convergence_criterion</span><span style="color: rgb(0,0,255);">&gt;</span> specifies a convergence criterion; the smaller this value, the deeper the convergence. <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">optimizer_max_iterations</span><span style="color: rgb(0,0,255);">&gt;</span> specifies an iteration limit for each time step. <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">optimizer_print_level</span><span style="color: rgb(0,0,255);">&gt;</span> allows diagnostic information to be printed. The larger the number (up to a maximum of 3), the more information that is printed.</p><h3 id="CMCSettingsFilesandXMLTagDefinitions-SettingsfortheCMCalgorithm">Settings for the CMC algorithm</h3><p>A number of properties are available for controlling the CMC algorithm proper. <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">cmc_time_window</span><span style="color: rgb(0,0,255);">&gt;</span> specifies the time allowed for time-dependent actuators like muscles to change force. If the window is too small, actuator forces will not have enough freedom to generate the desired accelerations. If the window is too large, the control will be too coarse to allow for good tracking (<a href="How%2BRRA%2BWorks.html">How RRA Works</a>). <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">use_curvature_filter</span><span style="color: rgb(0,0,255);">&gt;</span> specifies whether or not to apply a curvature filter to computed excitations. If control values are oscillating, the curvature filter can used to attenuate these oscillations. To apply the curvature filter, set <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">use_curvature_filter</span><span style="color: rgb(0,0,255);">&gt;</span> to <span style="color: rgb(0,128,0);"><strong>true</strong></span>. <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">adjust_com_to_reduce_residuals</span><span style="color: rgb(0,0,255);">&gt;</span> is a property used for residual reduction (Chapter 3). During CMC, this property should be set to <span style="color: rgb(0,128,0);"><strong>false</strong></span>.</p><h3 id="CMCSettingsFilesandXMLTagDefinitions-SpecifyingTrackingTasksandControlConstraints">Specifying Tracking Tasks and Control Constraints</h3><p>Which coordinates should be tracked and how those coordinates should be tracked are specified in a separate XML file specified by the property <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">task_set_file</span><span style="color: rgb(0,0,255);">&gt;</span>. Constraints on the controls (e.g., muscle excitations) are also specified in a separate XML file using the property <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">constraints_file</span><span style="color: rgb(0,0,255);">&gt;</span>. These files are covered below.</p><h3 id="CMCSettingsFilesandXMLTagDefinitions-SpecifyingActuatorstoExclude">Specifying Actuators to Exclude</h3><p>In version 3.1 and later, you can tell CMC to ignore specific actuators by adding them to the list of actuators using the property &lt;actuators_to_exclude&gt;. This is useful if you have, for example, a model component with its own controller.</p><h2 id="CMCSettingsFilesandXMLTagDefinitions-TaskSetFile">Task Set File</h2><p>A task set is used to specify which coordinates (e.g., joint angles) in a model should follow a desired kinematic trajectory. It also specifies the relative weighting between coordinates.</p><h3 id="CMCSettingsFilesandXMLTagDefinitions-TaskSets">Task Sets</h3><p>Tasks, the class objects used to specify a tracking goal, are kept in sets. Sets are lists of objects. The individual tasks are found between opening and closing xml tags <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">objects</span><span style="color: rgb(0,0,255);">&gt;</span> and <span style="color: rgb(0,0,255);">&lt;/</span><span style="color: rgb(128,0,0);">objects</span><span style="color: rgb(0,0,255);">&gt;</span>.</p><h3 id="CMCSettingsFilesandXMLTagDefinitions-TaskTypes">Task Types</h3><p>Although there will be additional task types in the future, such as orientation and point tracking, currently only tracking of generalized coordinates (or joints) is supported. The properties for each joint task are enclosed between opening and closing XML tags <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">CMC_Joint</span><span style="color: rgb(0,0,255);">&gt;</span> and <span style="color: rgb(0,0,255);">&lt;/</span><span style="color: rgb(128,0,0);">CMC_Joint</span><span style="color: rgb(0,0,255);">&gt;</span>.</p><h3 id="CMCSettingsFilesandXMLTagDefinitions-Example2XMLfilefortheCMCtasksetfile">Example 2: XML file for the CMC task set file</h3><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>gait2354_CMC_tasks.xml</b></div><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: html/xml; gutter: false">&lt;?xmlÂ version="1.0"Â encoding="UTF-8"?&gt;Â 

&lt;CMC_TaskSetÂ name="gait2354_CMC"&gt;Â 

  &lt;objects&gt;Â 

    &lt;CMC_JointÂ name="pelvis_tz"&gt;Â 
      &lt;on&gt; true &lt;/on&gt;Â 
      &lt;active&gt; true false false &lt;/active&gt;Â 
      &lt;weight&gt; 1.0e0 &lt;/weight&gt;Â 
      &lt;kp&gt; 100.0 &lt;/kp&gt;Â 
      &lt;kv&gt; 20.0 &lt;/kv&gt;Â 
      &lt;coordinate&gt; pelvis_tz &lt;/coordinate&gt;Â 
    &lt;/CMC_Joint&gt;Â 

    &lt;CMC_JointÂ name="hip_flexion_r"&gt;Â 
      &lt;on&gt; true &lt;/on&gt;Â 
      &lt;active&gt; true false false &lt;/active&gt;Â 
      &lt;weight&gt; 1.0e2 &lt;/weight&gt;Â 
      &lt;kp&gt; 100.0 &lt;/kp&gt;Â 
      &lt;kv&gt; 20.0 &lt;/kv&gt;Â 
      &lt;coordinate&gt; hip_flexion_r &lt;/coordinate&gt;Â 
    &lt;/CMC_Joint&gt;Â 

  &lt;/objects&gt;Â 

&lt;/CMC_TaskSet&gt;</pre>
		</div>
</div></div><p>Â </p><h3 id="CMCSettingsFilesandXMLTagDefinitions-TaskProperties" style="display: inline;">Task Properties</h3><p>Â </p><p>The property <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">on</span><span style="color: rgb(0,0,255);">&gt;</span> is used to turn a task on or off. The <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">active</span><span style="color: rgb(0,0,255);">&gt;</span> property specifies which component of task is active. While other task types might have three components, joint tasks only have one, so the typical setting is <span style="color: rgb(0,128,0);"><strong>true false false</strong></span>. Properties <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">kp</span><span style="color: rgb(0,0,255);">&gt;</span> and <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">kv</span><span style="color: rgb(0,0,255);">&gt;</span> specify the position and velocity error gains, respectively. See <a href="How%2BRRA%2BWorks.html">How RRA Works</a>Â for an explanation of error gains. The <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">coordinate</span><span style="color: rgb(0,0,255);">&gt;</span> property specifies to which model coordinate a task applies. The value of the property must agree with the name of the model coordinate exactly. Joints can be translational (e.g., pelvis_tz) or rotational (e.g., hip_flexion_r).</p><h2 id="CMCSettingsFilesandXMLTagDefinitions-ControlConstraintsFile">Control Constraints File</h2><h3 id="CMCSettingsFilesandXMLTagDefinitions-ControlSets">Control Sets</h3><p>The properties governing the controls in a simulation are contained in a <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">ControlSet</span><span style="color: rgb(0,0,255);">&gt;</span>. Controls are functions that vary as a function of time. Currently, two types of controls are supported: <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">ControlConstant</span><span style="color: rgb(0,0,255);">&gt;</span> and <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">ControlLinear</span><span style="color: rgb(0,0,255);">&gt;</span>. <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">ControlConstant</span><span style="color: rgb(0,0,255);">&gt;</span> objects are constant for any value of time. <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">ControlLinear</span><span style="color: rgb(0,0,255);">&gt;</span> objects consist of an array of paired time and control values or nodes (i.e., [t1,x1], [t2,x2], â¦ [tn,xn]). These values are linearly interpolated to determine the value of the control at a particular time. <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">ControlLinear</span><span style="color: rgb(0,0,255);">&gt;</span> is the class most commonly used during CMC and is reviewed further below.</p><h3 id="CMCSettingsFilesandXMLTagDefinitions-DefaultObjects">Default Objects</h3><p>Many control objects within a file may have the same values for a number of properties. At the beginning of a control set, there is a defaults section, demarcated by the opening and closing tags <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">defaults</span><span style="color: rgb(0,0,255);">&gt;</span> and <span style="color: rgb(0,0,255);">&lt;/</span><span style="color: rgb(128,0,0);">defaults</span><span style="color: rgb(0,0,255);">&gt;</span>, that can be used to specify default property values. If a control has the same value as the default control, that property need not be repeated.</p><h3 id="CMCSettingsFilesandXMLTagDefinitions-PropertiesofControlLinearControlType">Properties of &lt;ControlLinear&gt; Control Type</h3><p>A number of properties are used to describe the &lt;<span style="color: rgb(128,0,0);">ControlLinear</span>&gt; control type.</p><ul><li><span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">is_model_control</span><span style="color: rgb(0,0,255);">&gt;</span> indicates whether or not a control belongs to the model. Muscle excitations and actuator controls in general are examples of such controls. For specifying control constraints for CMC, this property should always be <span style="color: rgb(0,128,0);"><strong>true</strong></span>.Â </li><li><span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">extrapolate</span><span style="color: rgb(0,0,255);">&gt;</span> specifies that the value of the control should be extrapolated when the time value is outside the valid time range of a control (e.g., before t1 or after tn).Â </li><li><span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">default_min</span><span style="color: rgb(0,0,255);">&gt;</span> and <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">default_max</span><span style="color: rgb(0,0,255);">&gt;</span> specify the default minimum and default maximum values, respectively, of a control. For muscles, these are frequently <span style="color: rgb(0,128,0);"><strong>0.02</strong></span> and <span style="color: rgb(0,128,0);"><strong>1.00</strong></span> as in Example 3, belowÂ </li><li><span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">use_steps</span><span style="color: rgb(0,0,255);">&gt;</span> specifies whether or not the value of a control should be linearly interpolated between nodes. If set to <span style="color: rgb(0,128,0);"><strong>true</strong></span>, a control is treated as a step function in which the value of a step is determined by the value of the nearest node to the right or, equivalently, later in time. For CMC, it generally works better for muscle excitations to use steps.</li></ul><h3 id="CMCSettingsFilesandXMLTagDefinitions-Example3XMLfilefortheCMCcontrolconstraintsfile">Example 3: XML file for the CMC control constraints file</h3><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>gait2354_CMC_ControlConstraints.xml</b></div><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: html/xml; gutter: false">&lt;?xmlÂ version="1.0"Â encoding="UTF-8"?&gt;Â 

  &lt;ControlSetÂ name="gait2354_CMC"&gt;Â 

    &lt;defaults&gt;Â 

      &lt;ControlLinearÂ name="default"&gt;Â 
        &lt;is_model_control&gt; true &lt;/is_model_control&gt;Â 
        &lt;extrapolate&gt; true &lt;/extrapolate&gt;Â 
        &lt;default_min&gt; 0.02 &lt;/default_min&gt;Â 
        &lt;default_max&gt; 1.00 &lt;/default_max&gt;Â 
        &lt;use_steps&gt; true &lt;/use_steps&gt;Â 
      &lt;/ControlLinear&gt;Â 
 
    &lt;/defaults&gt;Â 

    &lt;objects&gt;Â 

      &lt;!--Residual actuators --&gt;Â 
      &lt;ControlLinearÂ name="FX.excitation"&gt;Â 
        &lt;default_min&gt; -1.0 &lt;/default_min&gt;Â 
        &lt;default_max&gt; 1.0 &lt;/default_max&gt;Â 
        &lt;use_steps&gt; false &lt;/use_steps&gt;Â 
      &lt;/ControlLinear&gt; 

      &lt;!-- Reserve actuators --&gt;Â 
      &lt;ControlLinearÂ name="hip_flexion_r_reserve.excitation"&gt;Â 
        &lt;default_min&gt; -1000 &lt;/default_min&gt;Â 
        &lt;default_max&gt; 1000 &lt;/default_max&gt;Â 
      &lt;/ControlLinear&gt;Â 

      &lt;!-- Muscles --&gt;Â 
      &lt;ControlLinearÂ name="glut_med1_r.excitation"Â /&gt;Â 
      &lt;ControlLinearÂ name="glut_med2_r.excitation"Â /&gt;Â 
      &lt;ControlLinearÂ name="glut_med3_r.excitation"Â /&gt;Â 
      &lt;ControlLinearÂ name="bifemlh_r.excitation"Â /&gt;Â 
      &lt;ControlLinearÂ name="bifemsh_r.excitation"Â /&gt;Â 

  &lt;/objects&gt;Â 

&lt;/ControlSet&gt;</pre>
		</div>
</div></div><p>Â </p><h3 id="CMCSettingsFilesandXMLTagDefinitions-Example4UsingcontrolconstraintsfiletoconstrainCMCexcitationstomatchEMGdata">Example 4: Using control constraints file to constrain CMC excitations to match EMG data</h3><p>When using CMC, sometimes the optimizer will choose to activate a muscle during a part of the movement when it should not be activated. For example, based on EMG recordings during running, we know that soleus should not have much activity during swing. But sometimes CMC will choose to activate the muscle since it is not informed about the EMG data. To get a better match with experimental EMG, we can constrain the activation CMC chooses for soleus during a specific time period of the movement.Â </p><div>Below is an example of a constraint, where the right soleus is specified to be off between 0.7272 and 0.9945s.Â </div><div>Â </div><div>The control constraints are displayed in the Excitation Editor GUI. Lines have been added to illustrate how the nodes are connected. The value associated with a node is applied <strong>before</strong> the specified time. In other words, when interpreting a control or its constraint (min or max value) it is the value from the future node at t(i+1) to the present node at t(i) that is applied.</div><div>Â </div><div><img class="confluence-embedded-image" width="700" src="attachments/3376201/3737212.png" data-image-src="attachments/3376201/3737212.png"></div><div>Â </div><div><p>Â </p><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>Control Constraints XML to Constraint Soleus</b></div><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: plain; gutter: false">&lt;ControlLinear name="soleus_r.excitation"&gt;
     &lt;min_nodes&gt;
          &lt;ControlLinearNode&gt;
               &lt;t&gt;0.7272&lt;/t&gt;
               &lt;value&gt;0.02&lt;/value&gt;
          &lt;/ControlLinearNode&gt;
          &lt;ControlLinearNode&gt;
               &lt;t&gt;0.9945&lt;/t&gt;
               &lt;value&gt;0.02&lt;/value&gt;
          &lt;/ControlLinearNode&gt;
          &lt;ControlLinearNode&gt;
               &lt;t&gt;1.143&lt;/t&gt;
               &lt;value&gt;0.02&lt;/value&gt;
          &lt;/ControlLinearNode&gt;
     &lt;/min_nodes&gt;
     &lt;max_nodes&gt;
          &lt;ControlLinearNode&gt;
               &lt;t&gt;0.7272&lt;/t&gt;
               &lt;value&gt;1&lt;/value&gt;
          &lt;/ControlLinearNode&gt;
          &lt;ControlLinearNode&gt;
               &lt;t&gt;0.9945&lt;/t&gt;
               &lt;value&gt;0.02&lt;/value&gt;
          &lt;/ControlLinearNode&gt;
          &lt;ControlLinearNode&gt;
               &lt;t&gt;1.143&lt;/t&gt;
               &lt;value&gt;1&lt;/value&gt;
          &lt;/ControlLinearNode&gt;
     &lt;/max_nodes&gt;
&lt;/ControlLinear&gt;</pre>
		</div>
</div></div><p>Â </p></div><h3 id="CMCSettingsFilesandXMLTagDefinitions-ResidualActuators">Residual Actuators</h3><p>Residual actuators are actuators that act directly between the model and the ground. These are used to control the global position and orientation of a model. If the residuals for a simulation have been reduced (see <a href="Residual%2BReduction%2BAlgorithm.html">Residual Reduction Algorithm</a>), the loads applied by these actuators should be relatively small. However, unlike muscles, the residual actuators can apply negative as well as positive forces. The minimum and maximum control values here, therefore, differ from the default values set at the top of the example file (0.02 and 1.0) and must be specified explicitly (-1.0 and 1.0).</p><h3 id="CMCSettingsFilesandXMLTagDefinitions-ReserveActuators">Reserve Actuators</h3><p>Reserve actuators are actuators that can make up for insufficient muscle strength during a simulation. However, they should only apply significant loads (e.g., forces above 1 N or 1 Nm) when necessary. To penalize the use of reserve actuators, the minimum and maximum control values are allowed to be very large (-1000 and 1000 in Example 3 above).Â Forces are specified in newtons and torques in newton-meters.</p><h3 id="CMCSettingsFilesandXMLTagDefinitions-Muscles">Muscles</h3><p>When a control has the same property values as that specified in the defaults section at the top of the control constraints file (Example 3), it is only necessary to have a one-line entry that specifies the name of the control.</p><p>Â </p><div class="panel" style="background-color: white;border-color: gray;border-style: solid;border-width: 5px;"><div class="panelContent" style="background-color: white;">
<p>Next: <a href="Analyses.html">Analyses</a></p><p>Previous: <a href="How%2Bto%2BUse%2Bthe%2BCMC%2BTool.html">How to Use the CMC Tool</a></p><p>Home: <a href="Computed%2BMuscle%2BControl.html">Computed Muscle Control</a></p>
</div></div>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/3376201/3737212.png">Control Constraints Example - Screen Shot.PNG</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" style="background: url(http://simtk-confluence.stanford.edu:8080/images/border/border_bottom.gif) repeat-x;">
                <p><small>Document generated by Confluence on Feb 24, 2014 09:28</small></p>
            </div>
        </div>     </body>
</html>
