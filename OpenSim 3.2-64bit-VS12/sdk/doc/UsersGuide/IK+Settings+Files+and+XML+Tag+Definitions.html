<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>OpenSim Documentation : IK Settings Files and XML Tag Definitions</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
        <div id="page">
            <div id="main">
                <div id="main-header" class="pageSectionHeader">
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            OpenSim Documentation : IK Settings Files and XML Tag Definitions
                        </span>
                    </h1>

                    <div class="page-metadata">
                        <p>This page last changed on Jan 23, 2014 by <font color="#0050B2">jenhicks</font>.</p>
                    </div>
                </div>

                <div id="content" class="view">
                    <div id="main-content" class="wiki-content group">
                    <p>The topics covered in this section include:</p><p><div>
<ul>
    <li><a href='#IKSettingsFilesandXMLTagDefinitions-InverseKinematicsSetupFile'>Inverse Kinematics Setup File</a></li>
<ul>
    <li><a href='#IKSettingsFilesandXMLTagDefinitions-IKExecutionParameters'>IK Execution Parameters</a></li>
    <li><a href='#IKSettingsFilesandXMLTagDefinitions-Model'>Model</a></li>
    <li><a href='#IKSettingsFilesandXMLTagDefinitions-IKTasks'>IK Tasks</a></li>
    <li><a href='#IKSettingsFilesandXMLTagDefinitions-Experimentalmarkerandcoordinatevalues'>Experimental marker and coordinate values</a></li>
    <li><a href='#IKSettingsFilesandXMLTagDefinitions-Timerange'>Time range</a></li>
    <li><a href='#IKSettingsFilesandXMLTagDefinitions-Outputfile'>Output file</a></li>
</ul>
    <li><a href='#IKSettingsFilesandXMLTagDefinitions-InverseKinematicsTasks'>Inverse Kinematics Tasks</a></li>
<ul>
    <li><a href='#IKSettingsFilesandXMLTagDefinitions-MarkerTasks'>Marker Tasks</a></li>
    <li><a href='#IKSettingsFilesandXMLTagDefinitions-CoordinateTasks'>Coordinate Tasks</a></li>
<ul>
    <li><a href='#IKSettingsFilesandXMLTagDefinitions-weighttag'>&lt;weight&gt; tag</a></li>
    <li><a href='#IKSettingsFilesandXMLTagDefinitions-Specifyexperimentalvaluestobematched'>Specify experimental values to be matched</a></li>
</ul>
</ul>
</ul></div></p><h2 id="IKSettingsFilesandXMLTagDefinitions-InverseKinematicsSetupFile">Inverse Kinematics Setup File</h2><p>There are three properties that need to be specified in an inverse kinematics setup file:</p><ol><li>The model to which the IK solver is to be applied;</li><li>The marker and coordinate error weightings to be used; and</li><li>The specific trial to be used by the solver.</li></ol><p>A sample inverse kinematics setup file is provided in the example beow: <br class="atl-forced-newline" /><span class="confluence-anchor-link" id="IKSettingsFilesandXMLTagDefinitions-ExampleIKSetupFile"></span></p><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b>subject01_Setup_IK.xml</b></div><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: html/xml; gutter: false">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;OpenSimDocument Version="30000"&gt;
    &lt;InverseKinemtaticsTool name="subject01"&gt;
        &lt;!--Name of the .osim file used to construct a model.--&gt;
        &lt;model_file&gt;subject01_simbody.osim&lt;/model_file&gt;
        &lt;!--Specify which optimizer to use (ipopt or cfsqp or jacobian).--&gt;
        &lt;!--Task set used to specify IK weights.--&gt;
        &lt;IKTaskSet name="gait2354_IK"&gt;
  			&lt;objects&gt;
    			&lt;!-- Markers --&gt;
    			&lt;IKMarkerTask name="Sternum"&gt; &lt;weight&gt;1&lt;/weight&gt; &lt;/IKMarkerTask&gt;
    			&lt;IKMarkerTask name="R.Acromium"&gt; &lt;weight&gt;0.5&lt;/weight&gt;&lt;/IKMarkerTask&gt;
    			&lt;IKMarkerTask name="L.Acromium"&gt; &lt;weight&gt; 0.5 &lt;/weight&gt;&lt;/IKMarkerTask&gt;
    			&lt;IKMarkerTask name="Top.Head"&gt; &lt;weight&gt; 0.1 &lt;/weight&gt; &lt;/IKMarkerTask&gt;
    			&lt;!-- . . additional &lt;IKMarkerTask&gt; tags cut for brevity . . --&gt;

    			&lt;!-- Coordinates --&gt;
    			&lt;IKCoordinateTask name="subtalar_angle_r"&gt; &lt;value&gt; 0 &lt;/value&gt;&lt;/IKCoordinateTask&gt;
				&lt;IKCoordinateTask name="mtp_angle_r"&gt; &lt;value&gt; 0 &lt;/value&gt;&lt;/IKCoordinateTask&gt;
				&lt;IKCoordinateTask name="subtalar_angle_l"&gt; &lt;value&gt; 0 &lt;/value&gt;&lt;/IKCoordinateTask&gt;
				&lt;IKCoordinateTask name="mtp_angle_l"&gt; &lt;value&gt; 0 &lt;/value&gt;&lt;/IKCoordinateTask&gt;
 		 &lt;/objects&gt;
		&lt;/IKTaskSet&gt;
		&lt;!--Parameters for solving the IK problem for each trial. Each trial
	    should get a seperate SimmIKTril block.--&gt;
        &lt;!--TRC file (.trc) containing the time history of experimental marker
				    positions.--&gt;
        &lt;marker_file&gt;subject01_walk1.trc&lt;/marker_file&gt;
        &lt;!--Name of file containing the joint angles used to set the initial
				    configuration of the model --&gt;
        &lt;coordinate_file&gt;&lt;/coordinate_file&gt;
        &lt;!--Time range over which the IK problem is solved.--&gt;
        &lt;time_range&gt;0.4 1.60&lt;/time_range&gt;
        &lt;!--Name of the motion file (.mot) to which the results should be written.--&gt;
        &lt;output_motion_file&gt;subject01_walk1_ik.mot&lt;/output_motion_file&gt;
        &lt;!--A positive scalar that is used to weight the importance of satisfying 
			constraints.A weighting of 'Infinity' or if it is unassigned results in 
			the constraints being strictly enforced.--&gt;
        &lt;constraint_weight&gt;20.0&lt;/constraint_weight&gt;
        &lt;!--The accuracy of the solution in absolute terms. I.e. the number of significant
			digits to which the solution can be trusted.--&gt;
        &lt;accuracy&gt;1e-5&lt;/accuracy&gt;
    &lt;/InverseKinemtaticsTool&gt;
&lt;/OpenSimDocument&gt;</pre>
		</div>
</div></div><p><strong>Example IK Setup File</strong><strong>: XML file for an inverse kinematics setup file</strong></p><h3 id="IKSettingsFilesandXMLTagDefinitions-IKExecutionParameters">IK Execution Parameters</h3><p>The parameters/properties for running the <span style="color: rgb(128,0,128);">IK</span> tool are enclosed inside the opening and closing tags <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">IKTool</span><span style="color: rgb(0,0,255);">&gt;</span> and <span style="color: rgb(0,0,255);">&lt;/</span><span style="color: rgb(128,0,0);">IKTool</span><span style="color: rgb(0,0,255);">&gt;</span>. If desired, the name attribute <span style="color: rgb(255,0,0);">name</span><span style="color: rgb(0,0,255);">=&quot;subject01&quot;</span> can be used to specify the execution name, though it is not used anywhere.</p><h3 id="IKSettingsFilesandXMLTagDefinitions-Model">Model</h3><p>The <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">model_file</span><span style="color: rgb(0,0,255);">&gt;</span> property specifies the file name of an OpenSim (.osim) model that will be used to match the experimental data and/or coordinate values. Typically this will be the subject-specific scaled model generated by the Scale Tool.</p><h3 id="IKSettingsFilesandXMLTagDefinitions-IKTasks">IK Tasks</h3><p>The IK tasks are used to specify the weights on the marker and coordinate error terms used by the IK solver. The set of IK tasks is specified in the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">IKTaskSet</span><span style="color: rgb(0,0,255);">&gt;</span> property. More details for specifying the IK tasks are presented below.</p><p>In OpenSim version 3.0 and earlier, the IK tasks could be specified in a separate file. In OpenSim version 3.1, a bug prevented loading IK tasks stored in a separate file. As of OpenSIm 3.2, you can load an old version IK setup file that has a separate tasks file. But when you save this setup, it will be merged into a single file. Moving forward, users should use a single IK setup file (i.e., no separate tasks file).</p><h3 id="IKSettingsFilesandXMLTagDefinitions-Experimentalmarkerandcoordinatevalues">Experimental marker and coordinate values</h3><p>The <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">marker_file</span><span style="color: rgb(0,0,255);">&gt;</span> property specifies a .trc file containing marker trajectories for this trial. These trajectories give the experimental marker positions which IK will attempt to match as described in <a href="How%2BInverse%2BKinematics%2BWorks.html">How Inverse Kinematics Works</a>.</p><p>The <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">coordinate_file</span><span style="color: rgb(0,0,255);">&gt;</span> property specifies a .mot file containing experimental coordinate values (e.g., joint angles computed using anatomical reference frames) for this trial. These values are read in from the file only if there is an IK Task for the coordinate that has a <span style="color: rgb(0,0,128);">&lt;</span><span style="color: rgb(128,0,0);">from_file</span><span style="color: rgb(0,0,128);">&gt; tag</span> set to <span style="color: rgb(0,128,0);"><strong>true</strong></span> (see <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">IKCoordinateTask</span><span style="color: rgb(0,0,255);">&gt;</span> in the <a href="IK%2BSettings%2BFiles%2Band%2BXML%2BTag%2BDefinitions.html">Example IK Task File</a> below).</p><p>If none of the coordinates have <span style="color: rgb(0,0,128);">&lt;</span><span style="color: rgb(128,0,0);">from_file</span><span style="color: rgb(0,0,128);">&gt;</span> set to <span style="color: rgb(0,128,0);"><strong>true</strong></span>, the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">coordinate_file</span><span style="color: rgb(0,0,255);">&gt;</span> property becomes optional. However, a coordinates (motion) file is typically specified even in this situation, because it may also contain other data, such as ground reaction forces and torques, which are copied into the output file generated by IK.</p><h3 id="IKSettingsFilesandXMLTagDefinitions-Timerange">Time range</h3><p>The <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">time_range</span><span style="color: rgb(0,0,255);">&gt;</span> tag specifies the start and end times for the IK computation (e.g., t=0.4s to t=2.0s in the example above). The time values are in whatever units of time were used in the marker and coordinate files, which must share a range with one another. Note that IK does not require time be expressed in seconds. However, future dynamics analyses which compute accelerations must have time expressed in seconds.</p><p>A start time earlier than the first available marker/coordinate data is snapped to the initial time of the data. Similarly, the end time is snapped to the final time of the data, if necessary. Time points that do not coincide with discrete times in the experimental data set are snapped to the nearest time point before the specified time. For example, a specified end time of 0.410s will be snapped to 0.400s if the next time instant is 0.417s from a motion capture system sampling at 60Hz.</p><p>Note that the marker file is used to determine the actual time steps (frames) at which IK is computed. Furthermore, if a coordinate file is used, the time values of the rows of data in the coordinate file must match the time values of the data in the marker file. OpenSim will report an error if a corresponding time in the coordinate file cannot be found.</p><h3 id="IKSettingsFilesandXMLTagDefinitions-Outputfile">Output file</h3><p><span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">output_motion_file</span><span style="color: rgb(0,0,255);">&gt;</span> specifies the name of the motion file generated by IK. The columns of this file are:</p><ul><li>Unprescribed generalized coordinates (those solved for by IK), followed by</li><li>Prescribed generalized coordinates (those with fixed values not solved for by IK), followed by</li><li>Any user data (data found in the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">coordinate_file</span><span style="color: rgb(0,0,255);">&gt;</span> which is not directly used by IK, e.g., ground reaction forces)</li></ul><p><br class="atl-forced-newline" />Each row represents an instant for which IK determined coordinates corresponding to the times in the marker data file. As a motion (.mot) file, each column has an associated label identifying the joint coordinate, ground reaction, center of pressure, etc. values.</p><h2 id="IKSettingsFilesandXMLTagDefinitions-InverseKinematicsTasks">Inverse Kinematics Tasks</h2><h3 id="IKSettingsFilesandXMLTagDefinitions-MarkerTasks">Marker Tasks</h3><p>The <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">IKMarkerTask</span><span style="color: rgb(0,0,255);">&gt;</span> tags are used to specify the weights associated with the marker error terms in the IK formulation. A specific marker is identified using the <span style="color: rgb(255,0,0);"><strong>name</strong></span> attribute of <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">IKMarkerTask</span><span style="color: rgb(0,0,255);">&gt;</span>.</p><p>The <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">weight</span><span style="color: rgb(0,0,255);">&gt;</span> property specifies the weight multiplying the squared-error term for that marker. These weights are the w<sub>i</sub>'s appearing in the formula given in <a href="How%2BInverse%2BKinematics%2BWorks.html">How Inverse Kinematics Works</a>. A larger weight means that the error term for that marker will be more significant in the least-squares equation, so the IK computation will try to find a closer match between that marker's position and its experimental position, as compared to a marker with a smaller weight. By default, the weight for a marker is assumed to be zero, indicating that the IK solver will not attempt to match that marker to its experimental position. The default weight is used if <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">weight</span><span style="color: rgb(0,0,255);">&gt;</span> is not specified or if the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">IKMarkerTask</span><span style="color: rgb(0,0,255);">&gt;</span> is omitted for a marker.</p><p>Experimental marker positions are not specified here. They come from the .trc file specified by the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">marker_file</span><span style="color: rgb(0,0,255);">&gt;</span> property of the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">IKTrial</span><span style="color: rgb(0,0,255);">&gt;</span> specified in the <a href="IK%2BSettings%2BFiles%2Band%2BXML%2BTag%2BDefinitions.html">Example IK Setup File</a>.</p><h3 id="IKSettingsFilesandXMLTagDefinitions-CoordinateTasks">Coordinate Tasks</h3><p>The <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">IKCoordinateTask</span><span style="color: rgb(0,0,255);">&gt;</span> tags are used to specify properties associated with the coordinate error terms in the IK formulation. A specific coordinate is identified using the <span style="color: rgb(255,0,0);"><strong>name</strong></span> attribute of <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">IKCoordinateTask</span><span style="color: rgb(0,0,255);">&gt;</span>.</p><p>Three properties can be specified in a <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">IKCoordinateTask</span><span style="color: rgb(0,0,255);">&gt;</span>: <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">weight</span><span style="color: rgb(0,0,255);">&gt;</span>, <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">from_file</span><span style="color: rgb(0,0,255);">&gt;</span>, and <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">value</span><span style="color: rgb(0,0,255);">&gt;</span>. These properties are not required.</p><h4 id="IKSettingsFilesandXMLTagDefinitions-weighttag">&lt;weight&gt; tag</h4><p>The <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">weight</span><span style="color: rgb(0,0,255);">&gt;</span> property specifies the weight multiplying the squared-error term for that coordinate. These weights are the ω<sub>i</sub>'s appearing in the formula given in <a href="How%2BInverse%2BKinematics%2BWorks.html">How Inverse Kinematics Works</a>. They tell the IK solver how closely it should try to match a given coordinate to its experimental value: the larger the weight, the closer the match should be.</p><p>Recall from <a href="How%2BInverse%2BKinematics%2BWorks.html">How Inverse Kinematics Works</a> that there are two types of coordinates: prescribed and unprescribed. If the OpenSim model specifies a coordinate to be locked (the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">IKCoordinateTask</span><span style="color: rgb(0,0,255);">&gt;</span> has <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">locked</span><span style="color: rgb(0,0,255);">&gt;</span> set to <span style="color: rgb(0,128,0);"><strong>true</strong></span>), then it is a prescribed coordinate. The lock symbol in the <a href="Coordinates%2BWindow.html">Coordinates Window</a> will also be in the locked position for this coordinate. Prescribed coordinates will be assigned an exact value and will not be solved for by IK. Thus, the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">weight</span><span style="color: rgb(0,0,255);">&gt;</span> property has no effect on prescribed coordinates; it is only relevant for unprescribed coordinates.</p><p>For an unprescribed coordinate, if <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">weight</span><span style="color: rgb(0,0,255);">&gt;</span> is not specified or if its <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">IKCoordinateTask</span><span style="color: rgb(0,0,255);">&gt;</span> is omitted altogether, the weight for that coordinate is assumed to be zero, meaning that IK will not attempt to match that coordinate to any particular value.</p><h4 id="IKSettingsFilesandXMLTagDefinitions-Specifyexperimentalvaluestobematched">Specify experimental values to be matched</h4><p>For both prescribed coordinates and unprescribed coordinates with nonzero weights, the experimental value to be matched needs to be specified. One way to do this is to specify a .mot file using the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">from_file</span><span style="color: rgb(0,0,255);">&gt;</span> and <span style="color: rgb(0,0,255);">&lt;/</span><span style="color: rgb(128,0,0);">from_file</span><span style="color: rgb(0,0,255);">&gt;</span> tags. If <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">from_file</span><span style="color: rgb(0,0,255);">&gt;</span> is set to <span style="color: rgb(0,128,0);"><strong>true</strong></span>, then the experimental coordinate values for that coordinate come from the .mot file specified by the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">coordinate_file</span><span style="color: rgb(0,0,255);">&gt;</span> property in the <a href="IK%2BSettings%2BFiles%2Band%2BXML%2BTag%2BDefinitions.html">Example IK Setup File</a>. </p><p>If <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">from_file</span><span style="color: rgb(0,0,255);">&gt;</span> is set to <span style="color: rgb(0,128,0);"><strong>false</strong></span> or is not specified, then a constant experimental value is used instead of the time-varying trajectory from a file. This constant value comes from:</p><ul><li>The <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">value</span><span style="color: rgb(0,0,255);">&gt;</span> property of the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">IKCoordinateTask</span><span style="color: rgb(0,0,255);">&gt;</span>, or if that's not specified then</li><li>The <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">value</span><span style="color: rgb(0,0,255);">&gt;</span> property of the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">SimmCoordinate</span><span style="color: rgb(0,0,255);">&gt;</span> in the OpenSim .osim model, or if that's not specified then</li><li>The <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">default_value</span><span style="color: rgb(0,0,255);">&gt;</span> property of the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">SimmCoordinate</span><span style="color: rgb(0,0,255);">&gt;</span> in the OpenSim .osim model.</li></ul><p>In the <span class="confluence-link">Example IK Setup File above</span>, the subtalar and mtp angles are locked (prescribed) in the model file. This is indicated in the Coordinates Window (the lock symbol is in the locked position)<span style="color: rgb(128,0,0);">.</span> So <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">value</span><span style="color: rgb(0,0,255);">&gt;</span> is used to specify that they should be locked at 0 radians. A <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">weight</span><span style="color: rgb(0,0,255);">&gt;</span> is not needed since these are prescribed coordinates and will be set to 0 exactly. Note, too, if the coordinate default was set to 0˚, you could have relied on the default behavior and omitted the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">IKCoordinateTask</span><span style="color: rgb(0,0,255);">&gt;</span> for the subtalar and mtp angles.</p><p> </p><div class="panel" style="background-color: white;border-color: gray;border-style: solid;border-width: 5px;"><div class="panelContent" style="background-color: white;">
<p>Next: <a href="Inverse%2BDynamics.html">Inverse Dynamics</a></p><p>Previous: <a href="How%2Bto%2BUse%2Bthe%2BIK%2BTool.html">How to Use the IK Tool</a></p><p>Home: <a href="Inverse%2BKinematics.html">Inverse Kinematics</a></p>
</div></div>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" style="background: url(http://simtk-confluence.stanford.edu:8080/images/border/border_bottom.gif) repeat-x;">
                <p><small>Document generated by Confluence on Feb 24, 2014 09:27</small></p>
            </div>
        </div>     </body>
</html>
