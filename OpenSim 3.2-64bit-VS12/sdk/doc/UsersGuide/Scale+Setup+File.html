<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>OpenSim Documentation : Scale Setup File</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
        <div id="page">
            <div id="main">
                <div id="main-header" class="pageSectionHeader">
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            OpenSim Documentation : Scale Setup File
                        </span>
                    </h1>

                    <div class="page-metadata">
                        <p>This page last changed on Jul 15, 2013 by <font color="#0050B2">chrisdembia</font>.</p>
                    </div>
                </div>

                <div id="content" class="view">
                    <div id="main-content" class="wiki-content group">
                    <p>The topics covered in this section include:</p><p><div>
<ul>
    <li><a href='#ScaleSetupFile-ExampleXMLfileforascalesetupfile'>Example: XML file for a scale setup file</a></li>
    <li><a href='#ScaleSetupFile-SpecifyingExecutionParameters'>Specifying Execution Parameters</a></li>
    <li><a href='#ScaleSetupFile-SpecifyingSubject-specificParameters'>Specifying Subject-specific Parameters</a></li>
    <li><a href='#ScaleSetupFile-notesTag'>&lt;notes&gt; Tag</a></li>
    <li><a href='#ScaleSetupFile-SpecifyingaGenericModeltoScale'>Specifying a Generic Model to Scale</a></li>
    <li><a href='#ScaleSetupFile-SpecifyingScalingProperties'>Specifying Scaling Properties</a></li>
<ul>
    <li><a href='#ScaleSetupFile-Propertiesformanualscaling'>Properties for manual scaling</a></li>
    <li><a href='#ScaleSetupFile-Propertiesformeasurement-basedscaling'>Properties for measurement-based scaling</a></li>
    <li><a href='#ScaleSetupFile-Massscalingproperties'>Mass scaling properties</a></li>
    <li><a href='#ScaleSetupFile-Specifyingoutputofscaling-onlystepbeforemarkerplacement'>Specifying output of scaling-only step (before marker placement)</a></li>
</ul>
    <li><a href='#ScaleSetupFile-SpecifyingMarkerPlacementProperties'>Specifying Marker Placement Properties</a></li>
<ul>
    <li><a href='#ScaleSetupFile-tagmarkerfiletag'><span class="confluence-anchor-link" id="ScaleSetupFile-tag" />&lt;marker_file&gt; tag</a></li>
    <li><a href='#ScaleSetupFile-coordinatefiletag'>&lt;coordinate_file&gt; tag</a></li>
    <li><a href='#ScaleSetupFile-Movingmarkerstomatchexperimentallocations'>Moving markers to match experimental locations</a></li>
    <li><a href='#ScaleSetupFile-Specifyingfinalscalingandmarkerplacementoutput'>Specifying final scaling and marker placement output</a></li>
</ul>
</ul></div></p><p>There are 5 major sections to a scale setup file: execution parameters; subject-specific parameters (e.g., mass, height, age); parameters related to the generic model to scale; scaling properties; and marker placement properties. A sample scale setup file is provided below. </p><h2 id="ScaleSetupFile-ExampleXMLfileforascalesetupfile">Example: XML file for a scale setup file</h2><div class="code panel" style="border-width: 1px;"><div class="codeHeader panelHeader" style="border-bottom-width: 1px;"><b> subject01_Setup_Scale.xml</b></div><div class="codeContent panelContent">
<div id="root">
		<pre class="theme: Confluence; brush: html/xml; gutter: false">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
&lt;OpenSimDocument Version="30000"&gt;
	&lt;ScaleTool name="subject01"&gt;
		&lt;!--Mass of the subject in kg.  Subject-specific model generated by scaling step will 
			have this total mass.--&gt;
		&lt;mass&gt;72.6&lt;/mass&gt;
		&lt;!--Height of the subject in mm.  For informational purposes only (not used by scaling).--&gt;
		&lt;height&gt;1803.4&lt;/height&gt;
		&lt;!--Age of the subject in years.  For informational purposes only (not used by scaling).--&gt;
		&lt;age&gt;99&lt;/age&gt;
		&lt;!--Notes for the subject.--&gt;
		&lt;notes&gt;This is an example setup file for scale.exe.&lt;/notes&gt;
		&lt;!--Specifies the name of the unscaled model (.osim) and the marker set.--&gt;
		&lt;GenericModelMaker&gt;
			&lt;!--Model file (.osim) for the unscaled model.--&gt;
			&lt;model_file&gt;gait2354_simbody.osim&lt;/model_file&gt;
			&lt;!--Set of model markers used to scale the model. Scaling is done based on distances 
				between model markers compared to the same distances between the corresponding 
				experimental markers.--&gt;
			&lt;marker_set_file&gt;gait2354_Scale_MarkerSet.xml&lt;/marker_set_file&gt;
		&lt;/GenericModelMaker&gt;
		&lt;!--Specifies parameters for scaling the model.--&gt;
		&lt;ModelScaler&gt;
			&lt;!--Whether or not to use the model scaler during scale--&gt;
			&lt;apply&gt;true&lt;/apply&gt;
			&lt;!--Specifies the scaling method and order. Valid options are 'measurements', 'manualScale', 
				singly or both in any sequence.--&gt;
			&lt;scaling_order&gt; measurements manualScale&lt;/scaling_order&gt;
			&lt;!--Specifies the measurements by which body segments are to be scaled.--&gt;
			&lt;MeasurementSet name="gait2354"&gt; 
				...
			&lt;/MeasurementSet&gt;
			&lt;!--Scale factors to be used for manual scaling.--&gt;
			&lt;ScaleSet name="gait2354_Scale"&gt;
				...
			&lt;/ScaleSet&gt;
			&lt;!--TRC file (.trc) containing the marker positions used for measurement-based scaling. 
				This is usually a static trial, but doesn't need to be.  The marker-pair distances 
				are computed for each time step in the TRC file and averaged across the time range.--&gt;
			&lt;marker_file&gt;subject01_static.trc&lt;/marker_file&gt;
			&lt;!--Time range over which to average marker-pair distances in the marker file (.trc) for 
				measurement-based scaling.--&gt;
			&lt;time_range&gt; 1 2&lt;/time_range&gt;
			&lt;!--Flag (true or false) indicating whether or not to preserve relative mass between 
				segments.--&gt;
			&lt;preserve_mass_distribution&gt;true&lt;/preserve_mass_distribution&gt;
			&lt;!--Name of OpenSim model file (.osim) to write when done scaling.--&gt;
			&lt;output_model_file&gt;subject01_scaledOnly.osim&lt;/output_model_file&gt;
			&lt;!--Name of file to write containing the scale factors that were applied to the unscaled 
				model (optional).--&gt;
			&lt;output_scale_file&gt;subject01_scaleSet_applied.xml&lt;/output_scale_file&gt;
		&lt;/ModelScaler&gt;
		&lt;!--Specifies parameters for placing markers on the model once a model is scaled. --&gt;
		&lt;MarkerPlacer&gt;
			&lt;!--Whether or not to use the marker placer during scale--&gt;
			&lt;apply&gt;true&lt;/apply&gt;
			&lt;!--Task set used to specify weights used in the IK computation of the static pose.--&gt;
			&lt;IKTaskSet name="gait2354_Scale_IKTaskSet"&gt;
				...
			&lt;/IKTaskSet&gt;
			&lt;!--TRC file (.trc) containing the time history of experimental marker positions (usually 
				a static trial).--&gt;
			&lt;marker_file&gt;subject01_static.trc&lt;/marker_file&gt;
			&lt;!--Name of file containing the joint angles used to set the initial configuration of 
				the model --&gt;
			&lt;coordinate_file&gt;Unassigned&lt;/coordinate_file&gt;
			&lt;!--Time range over which the marker positions are averaged.--&gt;
			&lt;time_range&gt; 1 1.01&lt;/time_range&gt;
			&lt;!--Name of the motion file (.mot) written after marker relocation (optional).--&gt;
			&lt;output_motion_file&gt;subject01_static_output.mot&lt;/output_motion_file&gt;
			&lt;!--Output OpenSim model file (.osim) after scaling and maker placement.--&gt;
			&lt;output_model_file&gt;subject01_simbody.osim&lt;/output_model_file&gt;
			&lt;!--Output marker set containing the new marker locations after markers have been placed.--&gt;
			&lt;output_marker_file&gt;Unassigned&lt;/output_marker_file&gt;
			&lt;!--Maximum amount of movement allowed in marker data when averaging frames of the static 
				trial. A negative value means there is not limit.--&gt;
			&lt;max_marker_movement&gt;-1&lt;/max_marker_movement&gt;
		&lt;/MarkerPlacer&gt;
	&lt;/ScaleTool&gt;
&lt;/OpenSimDocument&gt;</pre>
		</div>
</div></div><h2 id="ScaleSetupFile-SpecifyingExecutionParameters">Specifying Execution Parameters</h2><p>The properties for the scale operation are enclosed inside the opening and closing tags <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">ScaleTool</span><span style="color: rgb(0,0,255);">&gt;</span> and <span style="color: rgb(0,0,255);">&lt;/</span><span style="color: rgb(128,0,0);">ScaleTool</span><span style="color: rgb(0,0,255);">&gt;</span>. The name attribute <span style="color: rgb(255,0,0);">name</span><span style="color: rgb(0,0,255);">=&quot;subject01&quot;</span> specifies the execution name, though it is not used anywhere.</p><h2 id="ScaleSetupFile-SpecifyingSubject-specificParameters">Specifying Subject-specific Parameters</h2><p>Subject specific measurements are specified in the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">mass</span><span style="color: rgb(0,0,255);">&gt;</span>, <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">height</span><span style="color: rgb(0,0,255);">&gt;</span>, and <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">age</span><span style="color: rgb(0,0,255);">&gt;</span> properties. These are in kg, mm, and years, respectively. Currently, <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">height</span><span style="color: rgb(0,0,255);">&gt;</span> and <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">age</span><span style="color: rgb(0,0,255);">&gt;</span> are specified for informational purposes only, and do not affect the scaling result. (In fact, they do not appear in the subject-specific model output by <span style="color: rgb(128,0,128);">scale</span>). The <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">mass</span><span style="color: rgb(0,0,255);">&gt;</span> property, however, is used: the subject-specific model created by <span style="color: rgb(128,0,128);">scale</span> can be set to have a total mass equal to this specified mass value (see the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">preserve_mass_distribution</span><span style="color: rgb(0,0,255);">&gt; </span>tag described below).</p><h2 id="ScaleSetupFile-notesTag">&lt;notes&gt; Tag</h2><p>The <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">notes</span><span style="color: rgb(0,0,255);">&gt;</span> property is another purely informational (for the user) property that does not get propagated to any output files.</p><h2 id="ScaleSetupFile-SpecifyingaGenericModeltoScale">Specifying a Generic Model to Scale</h2><p>The generic model that will be scaled is specified within the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">GenericModelMaker</span><span style="color: rgb(0,0,255);">&gt;</span> tag. In particular, <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">model_file</span><span style="color: rgb(0,0,255);">&gt;</span> points to the OpenSim (.osim) model file that will be scaled. In Example 14-1 above, it is <strong>gait2354.osim</strong> (a gait model with 23 degrees of freedom and 54 muscles).</p><p>The <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">MarkerSet</span><span style="color: rgb(0,0,255);">&gt;</span> property can be used to add or update markers in the generic model. In the example, <strong>gait2354.osim</strong> does not include any markers, so the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">MarkerSet</span><span style="color: rgb(0,0,255);">&gt;</span> given in the external file <strong>gait2354_Scale_MarkerSet.xml</strong> (referred to using the <span style="color: rgb(255,0,0);"><strong>file</strong></span> attribute) adds the full marker set necessary for this example. This file is described in more detail in the <a href="Scale%2BSetup%2BFile.html">&lt;marker file&gt; tag</a> section below.</p><h2 id="ScaleSetupFile-SpecifyingScalingProperties">Specifying Scaling Properties</h2><p>Scaling properties are enclosed in the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">ModelScaler</span><span style="color: rgb(0,0,255);">&gt;</span> tag. As described in <a href="How%2BScaling%2BWorks.html">How Scaling Works</a>, a combination of measurement-based and manual scaling can be used. <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">scaling_order</span><span style="color: rgb(0,0,255);">&gt;</span> specifies which of the two is used (using the keywords <span style="color: rgb(0,128,0);"><strong>measurements</strong></span> and <span style="color: rgb(0,128,0);"><strong>manualScale</strong></span>, respectively), or, if both are listed, the order in which they are applied.</p><h3 id="ScaleSetupFile-Propertiesformanualscaling">Properties for manual scaling</h3><p>The <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">ScaleSet</span><span style="color: rgb(0,0,255);">&gt;</span> tag is used to specify the scale set supplying the manual scale factors. See <a class="createlink" href="/pages/createpage.action?spaceKey=OpenSim&amp;title=Scaling+Settings+Files+and+XML+Tag+Definitions&amp;linkCreation=true&amp;fromPageId=3376180">Scaling Settings Files and XML Tag Definitions</a> for more details about the contents of the ScaleSet.</p><h3 id="ScaleSetupFile-Propertiesformeasurement-basedscaling">Properties for measurement-based scaling</h3><p>The relevant parameters for measurement-based scaling are <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">MeasurementSet</span><span style="color: rgb(0,0,255);">&gt;</span>, <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">marker_file</span><span style="color: rgb(0,0,255);">&gt;</span>, and <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">time_range</span><span style="color: rgb(0,0,255);">&gt;</span>. <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">MeasurementSet</span><span style="color: rgb(0,0,255);">&gt;</span> specifies which marker pairs are used to compute the scales and which bodies those scale factors are applied to. In addition, the experimental marker positions need to be supplied. The <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">marker_file</span><span style="color: rgb(0,0,255);">&gt;</span> property points to a .trc file containing these marker positions, and <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">time_range</span><span style="color: rgb(0,0,255);">&gt;</span> indicates which subset of the frames in the .trc file the marker-pair distances should be averaged across.</p><h3 id="ScaleSetupFile-Massscalingproperties">Mass scaling properties</h3><p>The <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">preserve_mass_distribution</span><span style="color: rgb(0,0,255);">&gt;</span> property specifies whether the scaled model's segment masses should be in the same proportion as they were in the generic model (see <a href="How%2BScaling%2BWorks.html">How Scaling Works</a>).</p><h3 id="ScaleSetupFile-Specifyingoutputofscaling-onlystepbeforemarkerplacement">Specifying output of scaling-only step (before marker placement)</h3><p>The scaling step can (optionally) produce a number of output files. Assuming the marker placement step is executed, none of the intermediary output files from the scaling step are strictly necessary, but can be useful for debugging (e.g., to see what the model looks like after scaling but before markers are moved). The properties controlling the output file names are:</p><ul><li><span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">output_model_file</span><span style="color: rgb(0,0,255);">&gt;</span> generates the scaled-only OpenSim model file</li><li><span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">output_scale_file</span><span style="color: rgb(0,0,255);">&gt;</span> generates a <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">ScaleSet</span><span style="color: rgb(0,0,255);">&gt;</span> file consisting of the x-y-z scale factors used to scale each segment</li></ul><p>If the tags specifying these files are omitted or the file names are blank, then no files will be written.</p><h2 id="ScaleSetupFile-SpecifyingMarkerPlacementProperties">Specifying Marker Placement Properties</h2><p>The marker placement properties are enclosed within the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">MarkerPlacer</span><span style="color: rgb(0,0,255);">&gt;</span> tag. Note that it is valid to omit this section from the XML file if only scaling (and no marker placement) is desired.</p><p>As mentioned in <a href="How%2BScaling%2BWorks.html">How Scaling Works</a>, a &quot;static pose&quot; needs to be defined and the model needs to be placed in a configuration matching that pose as best as possible. This reduces to an inverse kinematics (IK) problem, and so many of the properties used in the marker placement step are similar to the properties in IK. The reader should therefore refer to the IK chapter (<a href="Inverse%2BKinematics.html">Inverse Kinematics</a>) for additional details on some of these properties.</p><p>The <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">IKTaskSet</span><span style="color: rgb(0,0,255);">&gt;</span> property is used to specify the marker and coordinate weights which IK will use in order to compute the static pose. More details of the file contents are given below.</p><p>The <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">marker_file</span><span style="color: rgb(0,0,255);">&gt;</span> and <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">coordinate_file</span><span style="color: rgb(0,0,255);">&gt;</span> properties are used to specify files containing experimental marker and coordinate values, respectively. These values are used by the IK tool to compute the static pose.</p><h3 id="ScaleSetupFile-tagmarkerfiletag"><span class="confluence-anchor-link" id="ScaleSetupFile-tag"></span>&lt;marker_file&gt; tag</h3><p>Since the file specified by the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">marker_file</span><span style="color: rgb(0,0,255);">&gt;</span> tag will in general have multiple frames of marker data (i.e., marker trajectories recorded during a static trial), these are averaged within the time range specified by the <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">time_range</span><span style="color: rgb(0,0,255);">&gt;</span> tags to give a single, fixed set of experimental marker positions. If the experimental marker locations in <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">marker_file</span><span style="color: rgb(0,0,255);">&gt;</span> do not represent a static trial (where the subject is not moving or only slightly moving) then averaging marker positions across a large time window does not really make sense. In this case, the values for <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">time_range</span><span style="color: rgb(0,0,255);">&gt;</span> should be reduced and/or the file specified by <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">marker_file</span><span style="color: rgb(0,0,255);">&gt;</span> should be edited to only contain a few rows of nearly-stationary marker positions.</p><h3 id="ScaleSetupFile-coordinatefiletag">&lt;coordinate_file&gt; tag</h3><p>The coordinate values specified by <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">coordinate_file</span><span style="color: rgb(0,0,255);">&gt;</span> are not averaged the same way the marker data is. Rather, the values from the row corresponding to the initial time of <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">time_range</span><span style="color: rgb(0,0,255);">&gt;</span> are used. In the example XML file for a scale setup file, the coordinate values from time t=1 will be used as the &quot;experimental coordinate values.&quot;</p><h3 id="ScaleSetupFile-Movingmarkerstomatchexperimentallocations">Moving markers to match experimental locations</h3><p>The IK solver will be invoked to try to find generalized coordinate values for the model which put it in a pose that closely matches the &quot;static pose&quot; experimental marker positions and coordinate values. After the model's static pose is computed, a selected subset of the model's markers are moved to match the averaged experimental marker locations (those that were used to define the static pose).</p><p>Only markers which are tagged as &quot;not fixed&quot; are moved to match the experimental markers. This is done within the file specified by <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">MarkerSet</span><span style="color: rgb(0,0,255);">&gt;</span>. Each marker that is moveable should have its <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">fixed</span><span style="color: rgb(0,0,255);">&gt;</span> property set to <span style="color: rgb(0,128,0);"><strong>false.</strong></span> <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">fixed</span><span style="color: rgb(0,0,255);">&gt;</span> is a property of <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">Marker</span><span style="color: rgb(0,0,255);">&gt;</span> (see <a href="Scale%2BMarker%2BFile.html">Scale Marker File</a>). The remaining markers are untouched.</p><h3 id="ScaleSetupFile-Specifyingfinalscalingandmarkerplacementoutput">Specifying final scaling and marker placement output</h3><p>After marker placement, the final subject-specific model is ready for output. The only essential file to be output in this step is the subject-specific OpenSim model, specified in <span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">output_model_file</span><span style="color: rgb(0,0,255);">&gt;</span>. Additional files can be output:</p><ul><li><span style="color: rgb(0,0,255);">&lt;</span><span style="color: rgb(128,0,0);">output_motion_file</span><span style="color: rgb(0,0,255);">&gt;</span> - a motion file consisting of a single row of values representing the &quot;static pose&quot; in which model markers were moved to match experimental markers. This file can be visualized in SIMM. Note: since this motion file only contains a single frame, to view it in SIMM's Model Viewer, you need to use the &quot;start &gt;&quot; button to start playing the motion; the motion slider in SIMM does not appear to work.</li></ul><div class="panel" style="background-color: white;border-color: gray;border-style: solid;border-width: 5px;"><div class="panelContent" style="background-color: white;">
<p>Next: <a href="Scale%2BMarker%2BFile.html">Scale Marker File</a></p><p>Previous: <a href="How%2Bto%2BUse%2Bthe%2BScale%2BTool.html">How to Use the Scale Tool</a></p><p>Home: <a href="Scaling.html">Scaling</a></p>
</div></div>
                    </div>

                    
                                                      
                </div>             </div> 
            <div id="footer" style="background: url(http://simtk-confluence.stanford.edu:8080/images/border/border_bottom.gif) repeat-x;">
                <p><small>Document generated by Confluence on Feb 24, 2014 09:27</small></p>
            </div>
        </div>     </body>
</html>
