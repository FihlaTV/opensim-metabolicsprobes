<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
    <head>
        <title>OpenSim Documentation : Getting Started with CMC</title>
        <link rel="stylesheet" href="styles/site.css" type="text/css" />
        <META http-equiv="Content-Type" content="text/html; charset=UTF-8">
    </head>

    <body>
        <div id="page">
            <div id="main">
                <div id="main-header" class="pageSectionHeader">
                    <h1 id="title-heading" class="pagetitle">
                                                <span id="title-text">
                            OpenSim Documentation : Getting Started with CMC
                        </span>
                    </h1>

                    <div class="page-metadata">
                        <p>This page last changed on Jul 25, 2013 by <font color="#0050B2">chrisdembia</font>.</p>
                    </div>
                </div>

                <div id="content" class="view">
                    <div id="main-content" class="wiki-content group">
                    <div class="wiki-content" style="margin-left: 0.0px;"><p>The purpose of Computed Muscle Control (CMC) is to compute a set of muscle excitations (or, more generally, actuator controls) that will drive a dynamic musculoskeletal model to track a set of desired kinematics in the presence of applied external forces (if applicable).</p><p>The Computed Muscle Control Tool is accessed by selecting <strong>Tools → Computed Muscle Control…</strong> from the OpenSim main menu bar. Like all tools, the operations performed by the Computed Muscle Control Tool apply to the current model.</p><p><div>
<ul>
    <li><a href='#GettingStartedwithCMC-Overview'>Overview</a></li>
    <li><a href='#GettingStartedwithCMC-SettingsFile'>Settings File</a></li>
    <li><a href='#GettingStartedwithCMC-Inputs'>Inputs</a></li>
    <li><a href='#GettingStartedwithCMC-Outputs'>Outputs</a></li>
    <li><a href='#GettingStartedwithCMC-BestPracticesandTroubleshootingTips'>Best Practices and Troubleshooting Tips</a></li>
<ul>
    <li><a href='#GettingStartedwithCMC-CMCSettings'>CMC Settings:</a></li>
    <li><a href='#GettingStartedwithCMC-CMCTroubleshooting'>CMC Troubleshooting:</a></li>
    <li><a href='#GettingStartedwithCMC-EvaluatingyourResults'>Evaluating your Results:</a></li>
</ul>
</ul></div></p><h2 id="GettingStartedwithCMC-Overview">Overview</h2><p>The figure below shows the required inputs and outputs for the Computed Muscle Control Tool. Each is described in more detail in the following sections.</p><p><br class="atl-forced-newline" /><img class="confluence-embedded-image" src="attachments/3376199/3737209.png" data-image-src="attachments/3376199/3737209.png"></p><p>Each of the files in this figure can be categorized as either<span style="color: rgb(51,153,102);"> experimental data</span>, an <span style="color: rgb(128,0,0);">OpenSim file (.osim)</span>, a <span style="color: rgb(51,102,255);">settings file</span>, or a <span style="color: rgb(128,0,128);">file generated by the workflow</span>.</p><div class='panelMacro'><table class='infoMacro'><colgroup><col width='24'><col></colgroup><tr><td valign='top'><img src="images/icons/emoticons/information.png" width="16" height="16" align="absmiddle" alt="" border="0"></td><td><p>The file names are examples that can be found in the examples/Gait2354_Simbody directory installed with the OpenSim distribution.</p></td></tr></table></div><h2 id="GettingStartedwithCMC-SettingsFile">Settings File</h2><p>The <span style="color: rgb(51,102,255);"><strong>subject01_Setup_CMC.xml</strong></span> file is a setup file for the CMC Tool, which specifies settings, inputs, and outputs that affect the behavior of the tracking controller to determine actuator (including muscles) controls. These can be defined using the GUI or by hand. Details of the settings are described in the section on the <a href="Graphical%2BUser%2BInterface.html">Graphical User Interface</a>.</p><p>The setup file identifies the actuators (i.e., the residual actuators, as required for dynamic consistency) as well as the kinematic tracking tasks. Furthermore, control constraints on the actuators (to limit the maximum residual force) can be specified.</p><h2 id="GettingStartedwithCMC-Inputs">Inputs</h2><p>Several data files are required as input by the Computed Muscle Control Tool:</p><p><span style="color: rgb(128,0,128);"><strong>subject01_walk1_RRA_Kinematics_q.sto</strong></span>: Contains the time histories of model kinematics, including the joint angles and pelvis translations from RRA.</p><p><span style="color: rgb(51,102,255);"><strong>gait2345_CMC_Tasks.xml</strong></span>: The tracking tasks file specifying which coordinates to track and the corresponding tracking weight (weights are relative and determine how &quot;well&quot; a joint angle will track the specified joint angle from RRA).</p><p><span style="color: rgb(51,102,255);"><strong>gait2345_CMC_ControlConstraints.xml</strong></span>: Contains limits on model actuators, which include muscles, reserve and residual actuators. The control constraints file specifies the maximum and minimum &quot;excitation&quot; (i.e., control signal) for each actuator. Control constraints can also be used to enforce when certain actuators are &quot;on&quot; or &quot;off&quot; and the range in which they can operate.</p><p><span style="color: rgb(0,204,153);"><strong>subject01_walk1_grf.xml</strong></span>: External load data (i.e., ground reaction forces, moments, and center of pressure location). See <a href="http://simtk-confluence.stanford.edu:8080/display/OpenSim/Inverse+Dynamics" rel="nofollow">Inverse Dynamics</a> for more details.</p><p><span style="color: rgb(165,0,33);"><strong>subject01_simbody_adjusted.osim</strong></span>: A subject-specific OpenSim model generated by scaling a generic model with the Scale Tool or by other means, along with an associated marker set containing adjusted virtual markers. The model must include inertial parameters. The model should have an adjusted torso center of mass to reduce residuals.</p><p><span style="color: rgb(51,102,255);"><strong>gait2345_CMC_Actuators.xml</strong></span>: Contains the residual and reserve actuators, as in RRA.</p><h2 id="GettingStartedwithCMC-Outputs">Outputs</h2><p>The Computed Muscle Control Tool primarily reports the necessary controls:</p><p><span style="color: rgb(128,0,128);"><strong>subject01_walk1_controls.xml</strong></span>: Contains the excitations to individual muscles as well as controls for any residual and/or reserve actuators.</p><p><span style="color: rgb(128,0,128);"><strong>subject01_CMC_forces.sto</strong></span> (not shown): Muscle forces and reserve/residual forces and torques.</p><p><span style="color: rgb(128,0,128);"><strong>subject01_walk1_states.sto </strong></span>(not shown): Model states and muscle states of the simulated motion (i.e., joint angles AND velocities, muscle fiber lengths AND activations).</p><h2 id="GettingStartedwithCMC-BestPracticesandTroubleshootingTips">Best Practices and Troubleshooting Tips</h2></div><div class="pageSection group"> <h4 id="GettingStartedwithCMC-CMCSettings">CMC Settings:</h4><ol><li>The reserve actuators are torques that are added about each joint to augment the actuator’s force in order to enable the simulation to run (reserves turn on when an actuator cannot produce the needed force at a given time point). To help minimize reserve torques, make an initial pass with default inputs, and then check reserves, residuals, and joint angle errors. To reduce reserves further, decrease tracking weights on coordinates with low error.</li><li>Optimal forces for reserves should be low to prevent the optimizer from &quot;wanting&quot; to use reserve actuators (an actuator with a large optimal force and a low excitation is &quot;cheap&quot; in the optimizer cost). If larger forces are needed for a successful simulation, increase the maximum control value of residuals. The residuals will then be able to generate sufficient force, but will be penalized for doing so.</li><li>If you are still getting high reserves for a particular degree-of-freedom during a particular time range in the simulation, it may be useful to examine more closely the muscles which span the degree-of-freedom during that time region (see <a href="attachments/3376092/3736743.pdf">TipsForDebuggingMuscleActuatedSimulations.pdf</a>). In particular:<br /><ol><li>Check passive muscle forces (e.g., quadriceps). Large passive forces (from large knee flexion angles) may induce active forces in the antagonistic muscles (e.g., hamstrings, gastrocnemius), which may not be desired. Passive forces cannot be controlled in CMC; they are purely a function of the whole-body kinematics of the motion. Although tempting, do not increase the maximum isometric force excessively unless you know its consequences in the muscle model. Since the passive muscle force is modeled as a function of maximum isometric force, if you increase the maximum isometric force in the hope of making your active muscles stronger, you will also be increasing the passive forces in the muscles as well, thereby not helping the situation. To decrease passive muscle forces, you want to reduce the passive muscle stiffness property of muscle (or, more specifically, increase the FmaxMuscleStrain parameter in the Thelen2003Muscle).</li><li>Check normalized fiber length during the motion (using the Plotter Tool). Is the muscle acting at suboptimal fiber lengths (i.e., less than 0.8 or greater than 1.2) at the time where the reserves are being generated? If so, then you may consider modifying either the tendon slack length or the optimal fiber length of the muscle so that it is operating more optimally (and, thus, capable of generating a greater force) during this time in the simulation. Although many cadaver studies report the optimal fiber length of a muscle, the tendon slack length is almost never reported, even though it is especially sensitive to the operating region on the force-length curve. Small adjustments to the tendon slack lengths can, therefore, be justified in reducing the reserves on the basis that we don't have as much confidence in this value to begin with.</li></ol></li><li>You should almost always use the &quot;fast&quot; target for CMC. Note that this is the default (e.g. if you run CMC through the GUI). You can only change this value in the xml setup file for the tool. The fast target requires the joint accelerations at each time step to be matched to the RRA results. &quot;Fast&quot; target should work for normal subjects; &quot;slow&quot; target may be needed for subjects with pathologies.</li><li>Start CMC at least 0.03 seconds before the point where you want to start analyzing your data, as CMC requires 0.03 seconds to initialize.</li><li>See <a href="http://simtk-confluence.stanford.edu:8080/display/OpenSim/How+CMC+Works">How CMC Works</a> and <a href="http://simtk-confluence.stanford.edu:8080/display/OpenSim/How+to+Use+the+CMC+Tool">How to Use the CMC Tool</a> for more information.</li></ol><h4 id="GettingStartedwithCMC-CMCTroubleshooting">CMC Troubleshooting:</h4><ol><li>If CMC is failing, try increasing the maximum excitation for reserves and residuals by orders of magnitude until the simulation runs, then try working your way back down while also &quot;relaxing&quot; tracking weights on coordinates.</li></ol><h4 id="GettingStartedwithCMC-EvaluatingyourResults">Evaluating your Results:</h4><ol><li>Peak reserve actuator torques should typically be less than 10% of the peak joint torque.</li><li>Peak residual forces should typically be less than 10-20 N; peak residual moments, less than 75 Nm (depending on the type of motion).</li><li>Double-check your kinematics in comparison to RRA. Generally, they should match well as long as you are using the &quot;fast&quot; target.</li><li>If performing an Induced Acceleration Analysis, you should verify that reserves and residuals contribute less than 5% to the net acceleration of interest.</li><li><p style="margin-left: 0.0px;">Compare the simulated activations to experimental EMG data (either recorded from your subject or from the literature). Activations should exhibit similar timing and magnitude to EMG data. You can also compare your muscle activations and/or forces to other simulations from SimTK or the literature.</p></li></ol><p>The table below shows an example of threshold values used to evaluate CMC results for full-body simulations of walking and running.</p><p><img class="confluence-embedded-image confluence-content-image-border" height="224" width="620" src="attachments/3376092/3736745.png" data-image-src="attachments/3376092/3736745.png" title="CMC_Thresholds_Dashboard.PNG"></p><p> </p><div class="panel" style="background-color: white;border-color: gray;border-style: solid;border-width: 5px;"><div class="panelContent" style="background-color: white;">
<p>Next: <a href="How%2BCMC%2BWorks.html">How CMC Works</a></p><p>Home: <a href="Computed%2BMuscle%2BControl.html">Computed Muscle Control</a></p>
</div></div></div>
                    </div>

                                        <div class="pageSection group">
                        <div class="pageSectionHeader">
                            <h2 id="attachments" class="pageSectionTitle">Attachments:</h2>
                        </div>

                        <div class="greybox" align="left">
                                                            <img src="images/icons/bullet_blue.gif" height="8" width="8" alt=""/>
                                <a href="attachments/3376199/3737209.png">CMCToolInputOutputDiagrams.png</a> (image/png)
                                <br/>
                                                    </div>
                    </div>
                    
                                                      
                </div>             </div> 
            <div id="footer" style="background: url(http://simtk-confluence.stanford.edu:8080/images/border/border_bottom.gif) repeat-x;">
                <p><small>Document generated by Confluence on Feb 24, 2014 09:27</small></p>
            </div>
        </div>     </body>
</html>
